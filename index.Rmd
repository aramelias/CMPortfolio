---
title: "Computational Musicology Portfolio"
author: "Aram Elias"
output:
  flexdashboard::flex_dashboard:
    storyboard: true
---

```{r include = FALSE}
knitr::opts_chunk$set(include = FALSE)
knitr::opts_chunk$set(error = FALSE)
library(tidyverse)
library(spotifyr)
library(compmus)
library(ggplot2)
library(plotly)
```

### Introduction

**Introduction**

Dutch progressive-metal band, *Ayreon*, has released six concept albums between 1995 and 2017. It may be worthwhile to compare these albums to one another to see how the band has developed over time, as while Ayreon's content is often described as having a unique, characteristic sound, it has not stayed the same. A human listener will be able to notice differences right away, with newer albums being described as "richer" or more complex.

Some songs in different albums reference one another, and for these it could also be interesting to see how much they have in common musically speaking. Some other songs are considered outliers due to not sounding the same as the rest of the album, or even having more in common with other albums to the human ear.

With most songs being over five minutes in length and having distinct musical segments with complex rhythms, and each album consisting of about fifteen songs, a large amount of data on this band is available on Spotify. As stated before, tracks on more recent albums are generally seen as more complex, and it may be of interest to see if this complexity affects other features of their songs that can be traced back to a trend across albums.

A limitation of this corpus would be a lack of other material to compare it with; however, with the band citing older bands such as Pink Floyd as inspiration, looking into similarities there might also be a good avenue for research.

```{r}
# Retrieve data
ayreon <- get_playlist_audio_features("", "3O1z9gRNz9DiB9wujbgLiV")

# Remove stray song
ayreon <- subset(ayreon, track.album.name != "Timeline")

# Remove unnecessary columns (mostly empty or irrelevant to the music itself)
ayreon <- subset(ayreon, select = -c(playlist_id, playlist_name, playlist_img, playlist_owner_name, playlist_owner_id,
                  added_at, primary_color, added_by.href, added_by.id, added_by.type, added_by.uri, added_by.external_urls.spotify,
                  track.artists, track.available_markets, track.disc_number, track.episode, track.explicit,
                  is_local, track.is_local, track.preview_url, track.track, track.type, video_thumbnail.url, mode,
                  track.album.album_type, track.album.artists, track.album.available_markets, track.album.href,
                  track.album.id, track.album.images, track.album.release_date_precision, track.album.type))

# Clean up some album names
ayreon$track.album.name[ayreon$track.album.name == "The Final Experiment (Special Edition)"] <- "The Final Experiment"
ayreon$track.album.name[ayreon$track.album.name == "Universal Migrator Pt.1 & 2"] <- "Universal Migrator"
ayreon$mode_name <- ifelse(ayreon$mode_name == "minor", "Minor", "Major")

# Put the albums in chronological order using a factor
ayreon$album_factor = factor(ayreon$track.album.name, levels = c("The Final Experiment", "Into The Electric Castle",
                                                                 "Universal Migrator", "The Human Equation",
                                                                 "01011001", "The Source"))
```

```{r}
# Creating a custom theme
theme_ayreon = function(){
  theme_linedraw() %+replace%
    theme(
      panel.grid = element_line(color = "gray")
    )
}
```

### Over time, Ayreon's albums have become more consistent in terms of valence and energy.

```{r include=TRUE, echo=FALSE}
ggplotly(ggplot(ayreon, aes(x = energy, y = valence, size = loudness, fill = mode_name)) +
  geom_point(shape = 21, color = "#000000", alpha = 0.5) +
  scale_x_continuous(limits = c(0, 1), breaks = c(0, 0.5, 1), minor_breaks = NULL) +
  scale_y_continuous(limits = c(0, 1), breaks = c(0, 0.5, 1), minor_breaks = NULL) +
  scale_size_continuous(trans = "exp", guide = "none") +
  facet_wrap(~album_factor) +
  labs(x = "Energy", y = "Valence", size = "Loudness", fill = "Mode") +
  ggtitle("Energy and valence of Ayreon albums") +
  theme_ayreon()
)
```

***

This plot is an overview of Ayreon's six albums, in chronological order. The valence and energy are plotted against each other on the axes, with each circle representing a track from the album in the title. The size of a circle represents the track's loudness and the color represents the mode.

It clearly shows that, especially through time, the band has gravitated towards higher-energy tracks with low to medium valence, and tracks have also become louder on average. Major-mode tracks also tend to have a higher energy and valence, but this is more clearly visible in later albums than in earlier ones. Most importantly, however, tracks have become more clustered in the lower-right region instead of being more spread-out.

### Length and Chroma

**Due to an error in R that keeps me from accessing the data frame despite successfully retrieving the analysis, I have not yet been able to fully process this track's chroma features.**

```{r include=TRUE, echo=FALSE}
osiris <- get_track_audio_analysis("39VbILtU4hPAb7zDxdiU4z")[6]$segments
chroma <- osiris$pitches

melody <- c()
for (i in seq(1, length(chroma), by=1)) {
  melody[[i]] <- which.max(chroma[[i]])
}

ggplot(NULL, aes(x = seq(1, length(chroma)), y = melody)) +
  geom_point() +
  labs(x = "Time", y = "Chroma") +
  theme_ayreon()
```

***

While many of Ayreon's songs have distinct parts, most of these are repeated throughout the course of one song in some way, shape or form. This can be seen in the track *Isis And Osiris*, from their second album, *Into The Electric Castle*. This song was chosen based on the fact that many listeners agree it to be most representative of their work, and because its structure is immediately noticeable to the human ear.

This plot shows the most dominant chroma of each beat in the song.